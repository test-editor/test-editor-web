sudo: false
dist: trusty

cache: yarn

env: 
  - FIREFOX_VERSION="latest"
  - FIREFOX_VERSION="58.0.2"

language: node_js
node_js:
  - "6"
os:
  - linux
before_install:
  # Install firefox for testing.
  - echo $FIREFOX_VERSION
  - export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
  - wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
  - mkdir /tmp/firefox-$FIREFOX_VERSION
  - tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
  - export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH 
  # Use a virtual display.
  - export DISPLAY=:99.0
  - sh -e /etc/init.d/xvfb start
  # Install latest chrome.
  - export CHROME_BIN=chromium-browser
  # Use newer Yarn version
  - curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.3.2
  - export PATH="$HOME/.yarn/bin:$PATH"
install:
  - yarn install
script: 
  - npm run build
  - firefox --version
  - npm run testCIFirefox

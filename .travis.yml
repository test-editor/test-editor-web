sudo: false
services:
- docker
dist: trusty
cache: yarn
env:
  matrix:
  - FIREFOX_VERSION="latest"
  - FIREFOX_VERSION="58.0.2"
  global:
    secure: wQeWxEYcKfGlgleEwfWVewXip+NeZavMESMYs7VR6dlqMszwB3n3asy0DBIRHhKhQk32D8BXis2cb0kdDCLJMbQ4c98Bv+aVot0oiemCmnMUHByf47DjgOE8KCpR/LIBFNdbbKEJJCi+RsK6gVcgQAqjCg/akvRHr+PGZmjjgXv2ogU7WwovH3MGrZ8NmJFC+NtZgStw7gg3bBi1QgMOWssZ0i6NO+XJFbp7oCrF8ANB2/d9iz2oyD6HeaLsNmX1KokvMkqUk/4HSpsEgpQTXuKB26vTb/2Sh5Yijzzn5Hhm5MoGdZ0c4WFymkHKGoj6iAI4AbYMPmw57ZGxBYQKs4kFth7BrfNqY0TbO90LOqFLD4LeXao2mB8OZZ5BQyLT/YuzvtnM1ZeR7YrrnSkblKYwj175ed2+j1hEFV7RwXTWdGMyLva+JcE2Dy2aiGFCsDMEF1MDYNMal5KwcaPQrP18hfICj5kpeksh3dAckR86X5ay2J87fjHZhcFNN9GAO2B3Hl055/GEjl3ZNEMHwVVV1Q5HVBydQM5FOnd3hI5YmlAMwOZudejvyIo1/vx3CRNtg2EJ7NZU4nMLE5VPVq8srlUf95wXXE55TlLlBGlwNwtTuAiovkhKHRpJbw/MYCEYI+4OZOdlv9JGq9KaIJ2VesBcMUnf1pul+BXkVdk=
language: node_js
node_js:
- '6'
os:
- linux
before_install:
# Install firefox for testing.
- echo $FIREFOX_VERSION
- export FIREFOX_SOURCE_URL='https://download.mozilla.org/?product=firefox-'$FIREFOX_VERSION'&lang=en-US&os=linux64'
- wget --no-verbose -O /tmp/firefox-$FIREFOX_VERSION.tar.bz2 $FIREFOX_SOURCE_URL
- mkdir /tmp/firefox-$FIREFOX_VERSION
- tar -xvf /tmp/firefox-$FIREFOX_VERSION.tar.bz2 -C /tmp/firefox-$FIREFOX_VERSION
- export PATH=/tmp/firefox-$FIREFOX_VERSION/firefox:$PATH
# Use a virtual display.
- export DISPLAY=:99.0
- sh -e /etc/init.d/xvfb start
- export CHROME_BIN=chromium-browser
# Use defined Yarn version
- curl -o- -L https://yarnpkg.com/install.sh | bash -s -- --version 1.7.0
- export PATH="$HOME/.yarn/bin:$PATH"
install:
- yarn install
script:
- yarn run build
- firefox --version
- yarn run testCIFirefox
# - yarn run e2e # currently non functional
- if [[ ( "$TRAVIS_PULL_REQUEST" = "false" ) && ( "$FIREFOX_VERSION" = "latest" ) && (( "$TRAVIS_BRANCH" = "master" ) || ( "$TRAVIS_TAG" != "" )) ]]; then yarn run docker:build && export TE_DEPLOY=true; fi
deploy:
  provider: script
  script: bash docker_push
  on:
    condition: "$TE_DEPLOY != ''"
    all_branches: true
